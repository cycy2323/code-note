<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zh">
<!--<![endif]-->

<!-- BEGIN HEAD -->
<head>
    <title>客户档案查询</title>
    <base href="../../">
    <script src="pages/scripts/header.js"></script>
    <meta http-equiv="content-type" content="text/html" charset="utf-8"/>

    <link href="assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href='assets/global/plugins/jquery-watable/watable.css' rel='stylesheet'/>
    <link href='assets/global/plugins/jquery-watable/animate.min.css' rel='stylesheet'/>
    <link href='assets/global/plugins/bootstrap-datetimepicker/css/datetimepicker.css' rel='stylesheet'/>

    <link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-select/bootstrap-select.min.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/select2/select2.css"/>
    <link rel="stylesheet" type="text/css" href="assets/global/plugins/jquery-multi-select/css/multi-select.css"/>
    <link href="assets/global/plugins/bootstrap-fileinput/fileinput.min.css" rel="stylesheet">

    <!-- BEGIN THEME STYLES -->
    <link href="assets/global/css/components.css" rel="stylesheet" type="text/css"/>
    <link href="assets/global/css/plugins.css" rel="stylesheet" type="text/css"/>
    <link href="assets/admin/layout/css/layout.css" rel="stylesheet" type="text/css"/>
    <link id="style_color" href="assets/admin/layout/css/themes/default.css" rel="stylesheet" type="text/css"/>
    <link href="assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/>
    <!-- END THEME STYLES -->
</head>
<!-- END HEAD -->

<body class="page-header-fixed page-quick-sidebar-over-content">

<!-- 标题栏开始 -->
<div class="page-header navbar navbar-fixed-top">
    <script>$.include("pages/partial/menu.shtml");</script>
</div>
<!-- 标题栏结束 -->
<div class="clearfix"></div>
<div class="page-container">
    <!-- 左侧菜单开始 -->
    <div class="page-sidebar-wrapper">
        <script>$.include("pages/partial/sidebar.shtml");</script>
    </div>
    <!-- 左侧菜单结束 -->

    <!-- 主内容开始 -->
    <div class="page-content-wrapper">
        <div class="page-content">
            <!--内容头开始-->
            <div class="row">
                <div class="col-md-12">
                    <ul class="page-breadcrumb breadcrumb">
                        <li>
                            <i class="fa fa-home"></i>
                            <a href="index.html">主页</a>
                            <i class="fa fa-angle-right"></i>
                        </li>
                        <li>
                            <a href="customer/archiveManagement.html">档案管理</a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- 内容头结束-->

            <!-- 内容开始-->
            <div class="container col-sm-12" style="padding-bottom:0px">
                <!-- 查询条件控件 -->
                <div class="row">
                    <div class="col-sm-3 form-group">
                        <div class="btn-group input-group input-select2me">
                            <div class="input-group-addon">供气区域：</div>
                            <select id="find_unit" class="form-control input-middle select2me" data-placeholder="供气区域">
                                <option value="">全部</option>
                            </select>
                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                        </div>
                    </div>
                    <div class="col-sm-3 form-group">
                        <div class="btn-group input-group input-select2me">
                            <div class="input-group-addon">核算员：</div>
                            <select id="find_countPer" class="form-control input-middle select2me" data-placeholder="核算员">
                                <option value="">全部</option>
                            </select>
                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                        </div>
                    </div>
                    <div class="col-sm-3 form-group">
                        <div class="btn-group input-group input-select2me">
                            <div class="input-group-addon">抄表员：</div>
                            <select id="find_servicePer" class="form-control input-middle select2me" data-placeholder="抄表员">
                                <option value="">全部</option>
                            </select>
                            <span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
                        </div>
                    </div>
                    <div class="col-sm-3 form-group">
                        <div class="btn-group input-group">
                            <div class="input-group-addon">客户编号：</div>
                            <input id="customerCode" class="inputclear form-control" type="text" placeholder="客户编号">
                            <span class="inputclear glyphicon glyphicon-remove-circle hide" ></span>
                        </div>
                    </div>
                    <div class="col-sm-3 form-group">
                        <div class="btn-group input-group">
                            <div class="input-group-addon">用气地址：</div>
                            <input class="inputclear form-control" type="text" placeholder="用户地址">
                            <span class="inputclear glyphicon glyphicon-remove-circle hide" ></span>
                        </div>
                    </div>

                    <div class="col-sm-3 form-group">
                        <div class="btn-group form-group">
                            <button id="find_button" class="btn yellow">
                                查询&nbsp; <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container-fluid">
                <div id="divtable" class="table-responsive container-fluid col-md-12" >
                </div>
            </div>
            <!-- 内容结束-->
        </div>
    </div>
    <!-- 主内容结束 -->
</div>

<script type="text/javascript">$.include("pages/partial/xwatable-form.shtml")</script>

<!-- 底边栏开始 -->
<script>$.include("pages/partial/foot.shtml");</script>
<!-- 底边栏结束 -->
</body>


<script>$.include("pages/partial/scripts.shtml");</script>
<script src="assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script type="text/javascript" src="assets/global/plugins/jquery-watable/jquery.watable.js"></script>
<script type="text/javascript" src="pages/scripts/rqlbuilder.js"></script>
<script type="text/javascript" src="pages/scripts/xwatable.js"></script>
<script type="text/javascript" src="pages/scripts/refhelper.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>

<script type="text/javascript" src="assets/global/plugins/bootstrap-select/bootstrap-select.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/select2/select2.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/jquery-multi-select/js/jquery.multi-select.js"></script>

<script src="assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>

<script type="text/javascript" src="assets/global/plugins/bootstrap-fileinput/fileinput.min.js"></script>
<script type="text/javascript" src="assets/global/plugins/bootstrap-fileinput/zh.js"></script>

<script src="assets/admin/pages/scripts/components-dropdowns.js"></script>

<script type="text/javascript">
    /*$(function () {
        $('#import_archive').click(function () {
            window.location="customer/import_archive.html";
        });
    })*/

   /* var valueFor=function(val){
    };
    var openButton = function() {
        return {
            f: function() {
                return "<a id='d_button' href='customer/archiveInfo.html'>查看&nbsp;<span class='glyphicon glyphicon-search'></span></a> ";
            }
        }
    }();*/
    $(function(){
//         供气区域helper
            var areaHelper=RefHelper.create({
                ref_url:"gasbizarea",
                ref_col:"areaId",
                ref_display:"areaName",
            });
            var areaFormat=function(){
                return {
                    f: function(val){
                        return areaHelper.getDisplay(val);
                    },
                }
            }();
            //核算员
            var userHelper=RefHelper.create({
                ref_url:'gassysuser/?query={"stationId":"1"}',
                ref_col:"userId",
                ref_display:"employeeName",
            });
            var userFormat=function(){
                return {
                    f: function(val){
                        return userHelper.getDisplay(val);
                    },
                }
            }();
            //抄表员
            var serverHelper=RefHelper.create({
                ref_url:'gassysuser/?query={"stationId":"2"}',
                ref_col:"userId",
                ref_display:"employeeName",
            });
            var serverFormat=function(){
                return {
                    f: function(val){
                        return serverHelper.getDisplay(val);
                    },
                }
            }();
                // 用气性质
            var gasTypeHelper=RefHelper.create({
                ref_url:"gasbizgastype",
                ref_col:"gasTypeId",
                ref_display:"gasTypeName",
            });
            var gasTypeFormat=function(){
                return {
                    f: function(val){
                        return gasTypeHelper.getDisplay(val);
                    },
                }
            }();
            var archiveIdFormat = function () {
                return {
                    f : function (val,row) {
                        return "<a href='customer/inhabitant_archiveInfo.html?" + row.ctmArchiveId + "'>" + '详情' + "</a>";
                    }
                }
            }();


            $.map(areaHelper.getData(), function(value, key) {
                $('#find_unit').append('<option value="'+key+'">'+value+'</option>');
            });
            $.map(userHelper.getData(), function(value, key) {
                $('#find_countPer').append('<option value="'+key+'">'+value+'</option>');
            });
            $.map(serverHelper.getData(), function(value, key) {
                $('#find_servicePer').append('<option value="'+key+'">'+value+'</option>');
            });




            XWATable.init(
                {
                    //----------------table的选项-------
                    pageSize: 50, 			//Initial pagesize
                    columnPicker: true,         //Show the columnPicker button
                    sorting: true,
                    transition: 'fade',  //(bounce, fade, flip, rotate, scroll, slide).
                    checkboxes: true,           //Make rows checkable. (Note. You need a column with the 'unique' property)
                    checkAllToggle:true,        //Show the check-all toggle//+RQLBuilder.like("KEYY", "a").rql()
                    rowClicked: function(data) {
                        console.log('row clicked');   //data.event holds the original jQuery event.
                        console.log(data);            //data.row holds the underlying row you supplied.
                    },
                    //----------------基本restful地址---
                    restbase: 'gasctmarchive',
                    key_column:'ctmArchiveId',
                    //---------------行定义
                    coldefs: [
                        {
                            col:"customerCode",
                            friendly:"客户编号",
                            readonly:"readonly",
                            sorting:false,
                            index:1
                        },
                        {
                            col:"customerName",
                            friendly:"客户名称",
                            sorting:false,
                            index:2
                        },
                        {
                            col:"customerAddress",
                            friendly:"客户地址",
                            sorting:false,
                            index:3
                        },
                        {
                            col:"customerState",
                            friendly:"客户状态",
                            readonly:"readonly",
                            // format:customerStateFormat,
                            sorting:false,
                            // hidden:true,
                            index:4
                        },
                        {
                            col:"gasTypeId",
                            friendly:"用气性质",
                            readonly:"readonly",
                            format:gasTypeFormat,
                            ref_url:  "gasbizgastype",
                            ref_name: "gasTypeName",
                            ref_value: "gasTypeId",
                            sorting:false,
                            index:5
                        },
                        {
                            col:"areaId",
                            friendly:"供气区域",
                            readonly:"readonly",
                            format:areaFormat,
                            ref_url:  "gasbizarea",
                            ref_name: "areaName",
                            ref_value: "areaId",
                            sorting:false,
                            index:6
                        },
                        {
                            col:"countPerId",
                            friendly:"核算员",
                            format:userFormat,
                            sorting:false,
                            index:7
                        },
                        {
                            col:"servicePerId",
                            format:serverFormat,
                            friendly:"抄表员",
                            sorting:false,
                            index:8
                        },
                        {
                            col:"bookCode",
                            friendly:"抄表本",
                            readonly:"readonly",
                            sorting:false,
                            index:9
                        },
                        {
                            col:"unboltTime",
                            friendly:"开栓时间",
                            readonly:"readonly",
                            inputsource:"datepicker",
                            hidden:true,
                            index:10
                        },
                        {
                            col:"createTime",
                            friendly:"创建时间",
                            readonly:"readonly",
                            inputsource:"datepicker",
                            hidden:true,
                            index:11
                        },
                        {
                            col:"ctmArchiveId",
                            friendly:"操作",
                            readonly:"readonly",
                            format:archiveIdFormat,
                            sorting:false,
                            index:12
                        }
                    ],
                    //---------------查询时过滤条件
                    findFilter: function(){//find function
                        /*var filter = "keyy="+$('#find_key').val();
                        return filter;*/

                        var find_area , find_countper,find_server,find_customerCode,find_bookCode;

                        if($('#find_unit').val())
                        {
                            find_area=RQLBuilder.equal("areaId",$('#find_unit').val());
                        }

                        if($('#find_countPer').val())
                        {
                            find_countper=RQLBuilder.like("countperId",$('#find_countPer').val());
                        }

                        if($('#find_servicePer').val())
                        {
                            find_server=RQLBuilder.like("serviceperId",$('#find_servicePer').val());
                        }

                        if($("#customerCode").val()){
                            find_customerCode = QLBuilder.equal("customerCode",$('#customerCode').val());
                        }


                        var filter=RQLBuilder.and([
                            find_area , find_countper ,find_server,find_customerCode
                        ]);
                        return filter.rql();


                    }//--findFilter
                }//--init
            );//--end init

            $('#find_provincename').on('input',function(e){
                console.log("changing::"+e.target.value)
                if(!e.target.value){
                    XWATable.autoResetSearch();
                }
            });
        }
    );
    jQuery(document).ready(function() {
        // initiate layout and plugins
        Metronic.init(); // init metronic core components
        Layout.init(); // init current layout
        QuickSidebar.init() // init quick sidebar
        ComponentsDropdowns.init();
    });
</script><!-- End of User Script-->
</html>