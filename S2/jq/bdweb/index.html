<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zh">

	<head>
		<title>OTCBD后台管理</title>
		<!--main页面需要引入的css样式-->
		<script src="pages/scripts/header.js"></script>
		<meta http-equiv="content-type" content="text/html" charset="utf-8" />
		<link href="assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="assets/global/plugins/bootstrap-fileinput/fileinput.css" rel="stylesheet">
		<link href="assets/admin/layout/css/warning.css" rel="stylesheet" type="text/css" />
		<link href='assets/global/plugins/jquery-watable/watable.css' rel='stylesheet' />
		<link href='assets/global/plugins/jquery-watable/animate.min.css' rel='stylesheet' />
		<link rel="shortcut icon" href="favicon.ico" />
		<link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-select/bootstrap-select.min.css" />
		<link rel="stylesheet" type="text/css" href="assets/global/plugins/select2/select2.css" />
		<link rel="stylesheet" type="text/css" href="assets/global/plugins/jquery-multi-select/css/multi-select.css" />
		<link rel="stylesheet" type="text/css" href="assets/global/plugins/jstree/dist/themes/default/style.min.css">
		<!--<link rel="stylesheet" type="text/css" href="assets/global/plugins/jquery-multi-select/css/multi-select.css"/>-->

		<link rel="stylesheet" type="text/css" href="assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css" />
		<link href="assets/global/css/components.css" rel="stylesheet" type="text/css" />
		<link href="assets/global/css/plugins.css" rel="stylesheet" type="text/css" />
		<style type="text/css">
			.dashboard-stat .details {
				font-size: 30px;
				font-family: Courier New !important;
			}
			.tabs li {
				height: 46px;
			}

			.tabs li a {
				line-height: 46px;
				height: 46px;
				border: none;
				padding: 0 20px;
				margin-left: 1px;
				color: #333333 !important;
			}

			.tabbable-custom>.nav-tabs>li.active {
				border-top: none;
				border-bottom: 2px solid #2c9dfa;
			}

			.tabbable-custom>.nav-tabs>li.active>a {
				background: none !important;
				color: #2c9dfa !important;
			}
			.banner img {
				width: 100%;
				margin-bottom: 20px;
			}
			.page-content {
				background: transparent;
			}
			.btn-group,
			.btn-group>.btn:first-child {
				display: block;
				float: none;
				padding: 0 40px;
				height: 80px;
				font-size: 20px;
				line-height: 80px;
				margin: 0 auto;
			}

			.btn>i {
				font-size: 18px;
			}
		</style>
	</head>

	<body class="page-header-fixed page-quick-sidebar-over-content">

		<!-- 标题栏开始 -->
		<div class="page-header navbar navbar-fixed-top">
			<script>
				$.include("pages/partial/menu.shtml");
			</script>
		</div>
		<!-- 标题栏结束 -->

		<div class="clearfix"></div>

		<div class="page-container">

			<!-- 左侧菜单开始 -->
			<div class="page-sidebar-wrapper" style="height:100%">
				<script>
					$.include("pages/partial/sidebar.shtml");
				</script>
			</div>
			<!-- 左侧菜单结束 -->

			<!-- 主内容开始 -->
			<div class="page-content-wrapper" id="tup">
				<div class="page-content" style="background: #f9f9fb !important;">
					<div class="row">
						<div class="col-md-12">
							<ul class="page-breadcrumb1 breadcrumb1">
								<li>
									<i class="fa fa-map-marker"></i>
									<a href="index.html">首页</a>
								</li>
							</ul>
						</div>
					</div>
					<!--内容头开始  先注释掉-->

					<!-- BEGIN DASHBOARD STATS -->
					<div class="row" id="numbers" style="margin-bottom: 20px;display:none;">

					</div>

					<div class="row top " style="float:left;clear:both;width: 230px;">
							<div class="widget yellw-bg no-padding" style="background:#ffffff;height:164px;">
								<div class="col-xs-7" style="height: 100%;">
									<p style="font-size:18px;color:#000000;height: 60px;margin-top: 10px;">可提现佣金</p>
									<p id="closing" style="font-size:25px;color:#8797EE;top: 10px;"></p>
								</div>
								<div class="col-xs-5" style="text-align:center;height: 100%;line-height: 220px;">
									<a id="edit_gp_onsubmit" style="font-size:13px;color:#6CC6B4;cursor: pointer;position: relative;top:25px;">提现</a>
									<a id="edit_gp" hidden="hidden"  data-target='#edit_gp_btn' data-toggle='modal'>提现</a>
								</div>
							</div>
						</div>

					<div class="row top" style="width: 83%;float:right;">
						<div class="widget yellw-bg no-padding" style="background:#ffffff;height: 164px;">
							<div style="height:40px;line-height:40px;">
								<span style="color:#000000;font-size: 16px;margin-left: 15px;">今日概况</span>
							</div>
							<div style="width:100%;height:1px;background:#e5e9f2"></div>
							<div class="col-xs-3" style="height:124px;background:url('images/order.png') no-repeat left 50% top 50%;"></div>
							<div class="col-xs-2" style="height:124px;text-align: center;">
								<div class="row" style="padding:20px;">
									<span style="color:#4a4a4a;font-size: 14px;">今日业绩收入</span>
								</div>
								<div class="row">
									<span style="color:#0cc2aa;font-size: 16px;" id="toresults">0</span>
								</div>
							</div>
							<div class="col-xs-2" style="height:124px;text-align: center;">
								<div class="row" style="padding:20px;">
									<span style="color:#4a4a4a;font-size: 14px;">订单数</span>
								</div>
								<div class="row">
									<span style="color:#0cc2aa;font-size: 16px;" id="ordnumber">0</span>
								</div>
							</div>
							<div class="col-xs-2" style="height:124px;text-align: center;">
								<div class="row" style="padding:20px;">
									<span style="color:#4a4a4a;font-size: 14px;">今日总流水</span>
								</div>
								<div class="row">
									<span style="color:#0cc2aa;font-size: 16px;" id="sumwater">0</span>
								</div>
							</div>

						</div>
					</div>


					<div style="width: 100%;float:left;clear:both;margin-top: 30px;">
						<div class="widget yellw-bg no-padding" style="background:#ffffff;height: 282px;">
							<div class="p-m">
								<div style="height:40px;line-height:40px;">
									<span style="color:#000000;font-size: 16px;margin-left: 15px;">常用功能</span>
								</div>
								<div style="width:100%;height:1px;background:#e5e9f2"></div>
							</div>
							<div class="col-xs-3" style="height:124px;text-align: center;">
								<div class="row" style="padding:20px;">
									<div class="col-xs-1" style="width: 30px;height: 30px;background:url('images/pay.png') no-repeat left 50% top 50%;"></div>
									<div class="col-xs-8" style="height:30px;line-height:30px;">
										<a style="color:#2e3e4e;font-size: 14px;cursor: pointer;">管理支付方式</a>
									</div>
								</div>
							</div>
							<div class="col-xs-3" style="height:124px;text-align: center;">
								<div class="row" style="padding:20px;">
									<div class="col-xs-1" style="width: 30px;height: 30px;background:url('images/yonghu.png') no-repeat left 50% top 50%;"></div>
									<div class="col-xs-8" style="height:30px;line-height:30px;">
										<a style="color:#2e3e4e;font-size: 14px;cursor: pointer;">用户充值订单</a>
									</div>
								</div>
							</div>
							<div class="col-xs-3" style="height:124px;text-align: center;">
								<div class="row" style="padding:20px;">
									<div class="col-xs-1" style="width: 30px;height: 30px;background:url('images/caiwu.png') no-repeat left 50% top 50%;"></div>
									<div class="col-xs-6" style="height:30px;line-height:30px;">
										<a style="color:#2e3e4e;font-size: 14px;cursor: pointer;">财务报表</a>
									</div>
								</div>
							</div>
							<div class="col-xs-3" style="height:124px;text-align: center;">
								<div class="row" style="padding:20px;">
									<div class="col-xs-1" style="width: 30px;height: 30px;background:url('images/zhuanru.png') no-repeat left 50% top 50%;"></div>
									<div class="col-xs-6" style="height:30px;line-height:30px;">
										<a style="color:#2e3e4e;font-size: 14px;cursor: pointer;">转入转出</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div>

		</div>

		<!--新增模态框-->
		<div class="modal fade" id="edit_gp_btn" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
						<h4 class="modal-title">申请提现</h4>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<form action="javascript:;" role="form" name="edit_form" id="edit_form" onSubmit="return beforeSubmit(this)">
								<div class="row">

									<div class="col-sm-6 form-group">
										<div class="btn-group input-group">
											<div class="input-group-addon">提现金额:</div>
											<input id="depositamount" name="depositamount" class="form-control" type="text" placeholder="" readonly="readonly">
											<span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
										</div>
									</div>

									<div class="col-sm-3 form-group" style="width: 279px;">
										<div class="btn-group input-group input-select2me">
											<div class="input-group-addon">收款账号:</div>
											<input id="zhdi" name="zhdi" class="form-control hide" type="text" placeholder="">
											<select id="shroffnumber" name="shroffnumber" class="form-control">

											</select>
											<span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
										</div>
									</div>
									<!-- <div class="col-sm-6 form-group">
										<div class="btn-group input-group">
											<div class="input-group-addon">收款账号:</div>
											<input id="shroffnumber" name="shroffnumber" class="form-control" type="text" placeholder="">
											<span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
										</div>
									</div> -->
									<div class="col-sm-6 form-group">
										<div class="btn-group input-group">
											<div class="input-group-addon">资金密码:</div>
											<input id="moneypwd" name="moneypwd" class="form-control" type="password" placeholder="">
											<span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
										</div>
									</div>

									<div class="col-sm-6 form-group">
										<div class="btn-group input-group">
											<div class="input-group-addon">谷歌验证码:</div>
											<input id="googlecode" name="googlecode" class="form-control" type="text" placeholder="">
											<span class="inputclear glyphicon glyphicon-remove-circle hide"></span>
										</div>
									</div>

								</div>

							</form>
						</div>

					</div>
					<div class="modal-footer">
						<button id="quxiao" type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button id="update_gp1" type="button" class="btn btn-primary" data-dismiss="modal">确定</button>
					</div>

				</div>
			</div>
		</div>

	</body>

	<script type="text/javascript">
		$.include("pages/partial/xwatable-form.shtml")
	</script>
	<script>
		$.include("pages/partial/scripts.shtml");
	</script>
	<script>
        var a = document.querySelector(".popup_content");
        var b = document.querySelector("#edit_gp");
        var c = document.querySelector("#cover");
        function openDialog() {
            a.style.display = "block";
            b.style.display = "block";
            c.style.display = "block";
        }
        function closeDialog() {
            a.style.display = "none";
            b.style.display = "none";
            c.style.display = "none";
        }
	</script>
	<!-- BEGIN PAGE LEVEL PLUGINS -->
	<script src="assets/global/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
	<script src="assets/global/plugins/flot/jquery.flot.resize.min.js" type="text/javascript"></script>
	<script src="assets/global/plugins/flot/jquery.flot.pie.min.js"></script>
	<script src="assets/addons/countUp.min.js" type="text/javascript"></script>

	<script src="pages/scripts/rest.js" type="text/javascript"></script>
	<script src="assets/addons/jquery-dateFormat.min.js" type="text/javascript"></script>
	<script src="assets/addons/dust-full-2.4.0.min.js" type="text/javascript"></script>
	<script src="assets/addons/dust-helpers-1.2.0.min.js" type="text/javascript"></script>
	<script src="assets/addons/dust-helpers-1.2.0.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="assets/global/plugins/jquery-watable/jquery.watable.js"></script>
	<script type="text/javascript" src="pages/scripts/rqlbuilder.js"></script>
	<script type="text/javascript" src="pages/scripts/xwatable.js"></script>
	<script type="text/javascript" src="pages/scripts/refhelper.js"></script>
	<script type="text/javascript" src="assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
	<script src="mods/indexEnum.js" type="text/javascript"></script>
	<script src="assets/global/plugins/jstree/dist/jstree.js"></script>

	<script type="text/javascript" src="assets/global/plugins/bootstrap-select/bootstrap-select.min.js"></script>
	<script type="text/javascript" src="assets/global/plugins/select2/select2.min.js"></script>
	<!--<script type="text/javascript" src="assets/global/plugins/jquery-multi-select/js/jquery.multi-select.js"></script>-->
	<script src="mods/bil.js"></script>
	<script src="mods/basismanage.js"></script>

	<script src="pages/scripts/index.js" type="text/javascript"></script>
	<script type="text/javascript" src="assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>

	<script src="mods/sys.js"></script>
	<script src="index/index.js"></script>
	<!-- MT Add End -->
	<script type="text/javascript">
		$(function() {
			var userId = JSON.parse(localStorage.getItem("user_info")).userId;
			if(userId == '10399' || userId == '10011' || userId == '12390' || userId == '10376') {
				$("#numbers").css("display", "block");
			}
			var easingFn = function(t, b, c, d) {
				var ts = (t /= d) * t;
				var tc = ts * t;
				return b + c * (tc * ts + -5 * ts * ts + 10 * tc + -10 * ts + 5 * t);
			}
			var options = {
				useEasing: true,
				easingFn: easingFn,
				useGrouping: true,
				separator: ',',
				decimal: '.',
				//formattingFn:formatnum
			};
			var upAnim = function(row, col, val, decimals) {
				if(!numAnim[row]) numAnim[row] = new Array();
				if(!numAnim[row][col]) {
					numAnim[row][col] = new CountUp("s_" + row + "_" + col, 0, val, decimals, 2, options);
					numAnim[row][col].start();
				} else {
					numAnim[row][col].update(val);
				}

			}
			var numAnim10, numAnim11;
			var numAnim20, numAnim21;
			var numAnim30, numAnim31;

			var numAnim = new Array();
			var formatnum = function(v) {
				if(v < 10000) return v;
				if(v > 10000) return(v / 10000.0).toFixed(2) + "万"
				//            if (v < 1000 * 10000) return (v / 10000 / 100).toFixed(2) + "百万"
				//            if (v < 10000 * 10000) return (v / 10000 / 1000).toFixed(2) + "千万"
				//             else return   (v / 10000 / 10000).toFixed(2) + "亿"
			}

			var loginarea = [];
			var areaId = JSON.parse(localStorage.getItem("user_info")).area_id
			/*GasModSys.areaList({
				"areaId": areaId,
				"cb": function(data) {
					$.each(data, function(key, val) {
						loginarea.push(val.areaId);
					})
				}
			});*/

			var ss = new Date();
			var year = ss.getFullYear();
			var month = ss.getMonth() + 1;
			var data = ss.getDate();
			//根据当前时间拼抄表月
			var times = function(year, month, data) {
				var lastmonth = "";
				var lastdata = "";
				var lastyear = "";
				var nextyear = "",
					nextmonth = "",
					nextdata = "";
				if(2 <= month <= 12 && 1 <= data < 26) {
					lastmonth = month - 1
					lastdata = 26
					lastyear = year;
					nextmonth = month;
					nextyear = year;
					nextdata = 26;
				}
				if(1 <= month <= 12 && data >= 26) {
					lastmonth = month
					lastdata = 26
					lastyear = year;
					nextmonth = month + 1;
					nextyear = year;
					nextdata = 26;
				}
				if(month == 1 && 1 <= data < 26) {
					lastmonth = "12";
					lastyear = year - 1;
					lastdata = 26;
					nextyear = year;
					nextmonth = month;
					nextdata = 26;
				}

				if(month == 12 && data >= 26) {
					lastyear = year;
					lastmonth = month;
					lastdata = 26;
					nextyear = year + 1;
					nextmonth = "01";
					nextdata = 26
				}
				if(lastmonth < 10) {
					lastmonth = "0" + lastmonth;
				}
				if(nextmonth > 1 && nextmonth < 10) {
					nextmonth = "0" + nextmonth
				}
				//            console.log(lastyear+"-"+lastmonth+"-"+lastdata+" $$$$$ "+nextyear+"-"+nextmonth+"-"+nextdata)
				return {
					lasts: lastyear + "-" + lastmonth + "-" + lastdata,
					nexts: nextyear + "-" + nextmonth + "-" + nextdata
				}
			}
			var shijian = times(year, month, data)

			//        select sum(undone_tmp) undone,sum(done_tmp+undone_tmp) done_all from
			//        (select (case when bill_state in ('0','1','2','3','7','8') then 1 else 0 end) undone_tmp, (case when bill_state in ('4','9') then 1 else 0 end) done_tmp from gas_csr_work_bill where area_id='15')
			//          created_time >= to_date(?,'yyyyMMdd') and created_time<to_date(?,'yyyyMMdd')
			var wheres0 = areaId == "1" ? "" : "area_id='" + areaId + "' and "
			var bds0 = {
				"cols": "sum(undone_tmp) undone,sum(done_tmp+undone_tmp) done_all",
				"froms": "(select (case when bill_state in ('0','1','2','3','6','7','8') then 1 else 0 end) undone_tmp, (case when bill_state in ('4','9') then 1 else 0 end) done_tmp from gas_csr_work_bill " +
					" where  " + wheres0 + " created_time >= to_date('" + shijian.lasts + " 00:00:00','yyyy-MM-dd HH24:MI:SS') and created_time<to_date('" + shijian.nexts + " 00:00:00','yyyy-MM-dd HH24:MI:SS'))",
				"wheres": "",
				"pages": false
			}
			/*$.ajax({
				url: "/bd/dbc/pbsel.do?bd=" + encodeURIComponent(JSON.stringify(bds0)),
				dataType: 'json',
				async: true
			}).done(function(data) {
				if(data && data.rows) {
					$("#s_0_0").html(formatnum(data.rows[0].undone))
					$("#s_0_1").html(formatnum(data.rows[0].doneAll))
				}
			})
*/
			var wheres1 = "";
			//if (UserInfo.item().area_id != '1') {created_time >= to_date('"+shijian.lasts+" 00:00:00','yyyy-MM-dd HH24:MI:SS') and created_time<to_date('"+shijian.nexts+" 00:00:00','yyyy-MM-dd HH24:MI:SS')
			wheres1 += "area_id in (" + loginarea.join() + ") and chg_id='1' and " +
				" trade_date >= to_date('" + shijian.lasts + " 00:00:00','yyyy-MM-dd HH24:MI:SS') and trade_date<to_date('" + shijian.nexts + " 00:00:00','yyyy-MM-dd HH24:MI:SS')"
			//}
			var bds = {
				"cols": "count(*) count,sum(money) sum",
				"froms": "gas_chg_settlement_detail",
				"wheres": wheres1,
				"page": false
			};

			/*$.ajax({
				url: "/bd/dbc/pbsel.do?bd=" + encodeURIComponent(JSON.stringify(bds)),
				dataType: 'json',
				async: true
			}).done(function(data) {
				if(data && data.rows) {
					$("#s_1_0").html(formatnum(data.rows[0].sum))
					$("#s_1_1").html(formatnum(data.rows[0].count))
				}
			})*/

			var wheres2 = "";
			wheres2 += "area_id in (" + loginarea.join() + ") and chg_id='2' and " +
				"trade_date >= to_date('" + shijian.lasts + " 00:00:00','yyyy-MM-dd HH24:MI:SS') and trade_date<to_date('" + shijian.nexts + " 00:00:00','yyyy-MM-dd HH24:MI:SS')"
			var bds2 = {
				"cols": "count(*) count,sum(money) sum",
				"froms": "gas_chg_settlement_detail",
				"wheres": wheres2,
				"page": false
			};

			/*$.ajax({
				url: "/bd/dbc/pbsel.do?bd=" + encodeURIComponent(JSON.stringify(bds2)),
				dataType: 'json',
				async: true
			}).done(function(data) {
				if(data && data.rows) {
					if(data.rows[0].sum) {
						$("#s_2_0").html(formatnum(data.rows[0].sum))
					}
					$("#s_2_1").html(formatnum(data.rows[0].count))
				}
			})*/
			var years = "",
				months = ""
			if(month == '12' && data >= 26) {
				years = year + 1;
			}
			if(1 <= month <= 12 && 1 <= data < 26) {
				years = year;
				months = month;
			}
			if(1 <= month < 12 && data >= 26) {
				years = year;
				months = month + 1
			}
			var whereClause3 = " report_month='" + months + "' and report_year ='" + years + "' and area_id in (" + loginarea.join() + ")"
			/*$.ajax({
				url: "hzqs/dbc/pbsel.do",
				type: "POST",
				contentType: "application/json;charset=utf-8",
				data: JSON.stringify({
					cols: "a.customer_kind, sum(normalNum)+sum(stopNum) + sum(longUseNum) + sum(noUseNum) c",
					froms: "gasReportArchive a",
					wheres: whereClause3 + " group by a.customer_kind",
					page: "false",
				}),
				dataType: "json",
				success: function(data) {
					var jumin = "";
					var feijumin = "";
					if(data.rows) {
						$.each(data.rows, function(index, item) {
							if(item.customerKind == "1") {
								jumin = item.c
							}
							if(item.customerKind == "9") {
								feijumin = item.c
							}
						})
						$("#s_3_0").html(jumin)
						$("#s_3_1").html(feijumin)
					}

				}
			})*/
		})
	</script>
</html>
