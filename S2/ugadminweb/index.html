<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zh">

	<head>
		<title>OTC后台管理</title>
		<!--main页面需要引入的css样式-->
		<script src="pages/scripts/header.js"></script>
		<meta http-equiv="content-type" content="text/html" charset="utf-8" />
		<link href="assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="assets/global/plugins/bootstrap-fileinput/fileinput.css" rel="stylesheet">
		<link href="assets/admin/layout/css/warning.css" rel="stylesheet" type="text/css" />
		<link href='assets/global/plugins/jquery-watable/watable.css' rel='stylesheet' />
		<link href='assets/global/plugins/jquery-watable/animate.min.css' rel='stylesheet' />
		<link rel="shortcut icon" href="favicon.ico" />
		<link rel="stylesheet" type="text/css" href="assets/global/plugins/bootstrap-select/bootstrap-select.min.css" />
		<link rel="stylesheet" type="text/css" href="assets/global/plugins/select2/select2.css" />
		<!--<link rel="stylesheet" type="text/css" href="assets/global/plugins/jquery-multi-select/css/multi-select.css"/>-->
		<script src="assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
		<script src="assets/global/plugins/bootbox/bootbox.min.js" type="text/javascript"></script>

		<link rel="stylesheet" type="text/css" href="assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css" />

		<link href="assets/global/css/components.css" rel="stylesheet" type="text/css" />
		<link href="assets/global/css/plugins.css" rel="stylesheet" type="text/css" />
		<style type="text/css">
			.dashboard-stat .details {
				font-size: 30px;
				font-family: Courier New !important;
			}

			.visual {
				padding-left: 30px;
				padding-top: 30px;
				width: 84px;
				height: 84px;
			}

			.number {
				font-family: HelveticaNeue Thin;
				font-size: 44px;
				color: #1bc6f9;
			}

			.desc {
				font-family: PingFangSC Regular;
				font-size: 14px !important;
				color: #353535;
				margin-top: 10px;
			}

			.tabs {
				height: 46px;
				background: #f5f5f6;
			}

			.tabs li {
				height: 46px;
			}

			.tabs li a {
				line-height: 46px;
				height: 46px;
				border: none;
				padding: 0 20px;
				margin-left: 1px;
				color: #333333 !important;
			}

			.tabbable-custom>.nav-tabs>li.active {
				border-top: none;
				border-bottom: 2px solid #2c9dfa;
			}

			.tabbable-custom>.nav-tabs>li.active>a {
				background: none !important;
				color: #2c9dfa !important;
			}

			.blocks {
				width: 24.25% !important;
				padding: 0;
			}

			.banner {
				width: 100%;
			}

			.banner img {
				width: 100%;
				margin-bottom: 20px;
			}
			/*
			.page-container {
				background: url(assets/admin/bg/c.png) no-repeat;
				background-size: cover;
				background-position: center;
			}*/

			.page-content {
				background: transparent;
			}

			.btn-group,
			.btn-group-vertical {
				width: 33%;
				padding: 50px;
			}

			.btn-group>.btn:first-child {
				display: block;
				float: none;
				padding: 0 40px;
				height: 80px;
				font-size: 20px;
				line-height: 80px;
				margin: 0 auto;
			}
			.btn > i {
				font-size: 18px;
			}
		</style>
	</head>

	<body class="page-header-fixed page-quick-sidebar-over-content">

		<!-- 标题栏开始 -->
		<div class="page-header navbar navbar-fixed-top">
			<script>
				$.include("pages/partial/menu.shtml");
			</script>
		</div>
		<!-- 标题栏结束 -->

		<div class="clearfix"></div>

		<div class="page-container">

			<!-- 左侧菜单开始 -->
			<div class="page-sidebar-wrapper" style="height:100%">
				<script>
					$.include("pages/partial/sidebar.shtml");
				</script>
			</div>
			<!-- 左侧菜单结束 -->

			<!-- 主内容开始 -->
			<div class="page-content-wrapper" id="tup">
				<div class="page-content" style="background: #f9f9fb !important;">
					<!--<div class="row">
						<div class="col-md-12">
							<ul class="page-breadcrumb1 breadcrumb1">
								<li>
									<i class="fa fa-map-marker"></i>
									<a href="index.html">首页</a>
								</li>
							</ul>
						</div>
					</div>-->
					<!--内容头开始  先注释掉-->

					<!-- BEGIN DASHBOARD STATS -->
					<div class="row" id="numbers" style="margin-bottom: 20px;display:none;">

					</div>

					<div class="btn-group form-group">
						<button id="edit_btn" class="btn blue aaa" onclick="window.location.href='/advert/advert.html'">
					        <i class="fa fa-eye bbb"></i> 商户广告列表&nbsp;
					    </button>
					</div>

					<div class="btn-group form-group">
						<button id="edit_btn" class="btn blue aaa" onclick="window.location.href='/transfer/transfe.html'">
					        <i class="fa fa-eye bbb"></i> 内部资产划转&nbsp;
					    </button>
					</div>

					<div class="btn-group form-group">
						<button id="edit_btn" class="btn blue aaa" onclick="window.location.href='/finance/finance.html'">
					        <i class="fa fa-eye bbb"></i> 订单统计分析&nbsp;
					    </button>
					</div>
					<br />
					<div class="btn-group form-group">
						<button id="edit_btn" class="btn blue aaa" onclick="window.location.href='/account/user/useraccount.html'">
					        <i class="fa fa-eye bbb"></i> 用户账户管理&nbsp;
					    </button>
					</div>

					<div class="btn-group form-group">
						<button id="edit_btn" class="btn blue aaa" onclick="window.location.href='/account/merchant/merchant.html'">
					        <i class="fa fa-eye bbb"></i> 商户账户管理&nbsp;
					    </button>
					</div>

					<div class="btn-group form-group">
						<button id="edit_btn" class="btn blue aaa" onclick="window.location.href='/payment/nameapprove.html'">
					        <i class="fa fa-eye bbb"></i> 实名认证审批&nbsp;
					    </button>
					</div>

					<!-- END DASHBOARD STATS -->
					<!-- 内容头结束-->

					<!-- TODO 此处写内容 -->

				</div>

			</div>
			<!-- 主内容结束 -->

		</div>

		<!-- 底边栏开始 -->

		<!-- 底边栏结束 -->
	</body>

	<script type="text/javascript">
		$.include("pages/partial/xwatable-form.shtml")
	</script>
	<script>
		$.include("pages/partial/scripts.shtml");
	</script>
	<script language="javascript">
        //防止页面后退
        history.pushState(null, null, document.URL);
        window.addEventListener('popstate', function () {
            history.pushState(null, null, document.URL);
        });
	</script>
	<!-- BEGIN PAGE LEVEL PLUGINS -->
	<script src="assets/global/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
	<script src="assets/global/plugins/flot/jquery.flot.resize.min.js" type="text/javascript"></script>
	<script src="assets/global/plugins/flot/jquery.flot.pie.min.js"></script>
	<script src="assets/addons/countUp.min.js" type="text/javascript"></script>

	<script src="pages/scripts/rest.js" type="text/javascript"></script>
	<script src="assets/addons/jquery-dateFormat.min.js" type="text/javascript"></script>
	<script src="assets/addons/dust-full-2.4.0.min.js" type="text/javascript"></script>
	<script src="assets/addons/dust-helpers-1.2.0.min.js" type="text/javascript"></script>
	<script src="assets/addons/dust-helpers-1.2.0.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="assets/global/plugins/jquery-watable/jquery.watable.js"></script>
	<script type="text/javascript" src="pages/scripts/rqlbuilder.js"></script>
	<script type="text/javascript" src="pages/scripts/xwatable.js"></script>
	<script type="text/javascript" src="pages/scripts/refhelper.js"></script>
	<script src="mods/indexEnum.js" type="text/javascript"></script>

	<script type="text/javascript" src="assets/global/plugins/bootstrap-select/bootstrap-select.min.js"></script>
	<script type="text/javascript" src="assets/global/plugins/select2/select2.min.js"></script>
	<!--<script type="text/javascript" src="assets/global/plugins/jquery-multi-select/js/jquery.multi-select.js"></script>-->
	<script src="mods/bil.js"></script>

	<script src="pages/scripts/index.js" type="text/javascript"></script>
	<script type="text/javascript" src="assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>

	<script src="mods/sys.js"></script>

	<!-- MT Add End -->
	<script type="text/javascript">
		$(function() {
			//稽查大队、计量中心隐藏dashboard-stat start
			var userId = JSON.parse(localStorage.getItem("user_info")).userId;
			//        var unitId = UserInfo.item().unit_id;
			//        var bd = {
			//            "cols": "distinct *",
			//            "froms": " gas_sys_unit ",
			//            "wheres": wheres,
			//            "page": false
			//        }
			//        var wheres = "connect by nocycle prior parent_unit_id = unit_id start with parent_unit_id in('5','12') or unit_id in('5','12'); "
			//
			//        $.ajax({
			//        contentType: "application/json;charset=utf-8",
			//            type: "POST",
			//             url: "/txs/dbc/pbsel.do?bd=" + encodeURIComponent(JSON.stringify(bd)),
			//           dataType: 'json',
			//           data: JSON.stringify(bd),
			//           success: function (data) {
			//                if (unitId == data.rows[0].unitId) {
			//                    $(".dashboard-stat").css('display', 'none');
			//                }
			//             }
			//         });
			//         --10399 赵鹏   --10011刘扬      --12390   刘斌    10376  戴云鹏
			if(userId == '10399' || userId == '10011' || userId == '12390' || userId == '10376') {
				$("#numbers").css("display", "block");
			}

			//dashboard-stat display end

			var easingFn = function(t, b, c, d) {
				var ts = (t /= d) * t;
				var tc = ts * t;
				return b + c * (tc * ts + -5 * ts * ts + 10 * tc + -10 * ts + 5 * t);
			}
			var options = {
				useEasing: true,
				easingFn: easingFn,
				useGrouping: true,
				separator: ',',
				decimal: '.',
				//formattingFn:formatnum
			};
			var upAnim = function(row, col, val, decimals) {
				if(!numAnim[row]) numAnim[row] = new Array();
				if(!numAnim[row][col]) {
					numAnim[row][col] = new CountUp("s_" + row + "_" + col, 0, val, decimals, 2, options);
					numAnim[row][col].start();
				} else {
					numAnim[row][col].update(val);
				}

			}
			var numAnim10, numAnim11;
			var numAnim20, numAnim21;
			var numAnim30, numAnim31;

			var numAnim = new Array();
			var formatnum = function(v) {
				if(v < 10000) return v;
				if(v > 10000) return(v / 10000.0).toFixed(2) + "万"
				//            if (v < 1000 * 10000) return (v / 10000 / 100).toFixed(2) + "百万"
				//            if (v < 10000 * 10000) return (v / 10000 / 1000).toFixed(2) + "千万"
				//             else return   (v / 10000 / 10000).toFixed(2) + "亿"
			}

			var loginarea = [];
			var areaId = JSON.parse(localStorage.getItem("user_info")).area_id
			GasModSys.areaList({
				"areaId": areaId,
				"cb": function(data) {
					$.each(data, function(key, val) {
						loginarea.push(val.areaId);
					})
				}
			});

			var ss = new Date();
			var year = ss.getFullYear();
			var month = ss.getMonth() + 1;
			var data = ss.getDate();
			//根据当前时间拼抄表月
			var times = function(year, month, data) {
				var lastmonth = "";
				var lastdata = "";
				var lastyear = "";
				var nextyear = "",
					nextmonth = "",
					nextdata = "";
				if(2 <= month <= 12 && 1 <= data < 26) {
					lastmonth = month - 1
					lastdata = 26
					lastyear = year;
					nextmonth = month;
					nextyear = year;
					nextdata = 26;
				}
				if(1 <= month <= 12 && data >= 26) {
					lastmonth = month
					lastdata = 26
					lastyear = year;
					nextmonth = month + 1;
					nextyear = year;
					nextdata = 26;
				}
				if(month == 1 && 1 <= data < 26) {
					lastmonth = "12";
					lastyear = year - 1;
					lastdata = 26;
					nextyear = year;
					nextmonth = month;
					nextdata = 26;
				}

				if(month == 12 && data >= 26) {
					lastyear = year;
					lastmonth = month;
					lastdata = 26;
					nextyear = year + 1;
					nextmonth = "01";
					nextdata = 26
				}
				if(lastmonth < 10) {
					lastmonth = "0" + lastmonth;
				}
				if(nextmonth > 1 && nextmonth < 10) {
					nextmonth = "0" + nextmonth
				}
				return {
					lasts: lastyear + "-" + lastmonth + "-" + lastdata,
					nexts: nextyear + "-" + nextmonth + "-" + nextdata
				}
			}
			var shijian = times(year, month, data)

			//        select sum(undone_tmp) undone,sum(done_tmp+undone_tmp) done_all from
			//        (select (case when bill_state in ('0','1','2','3','7','8') then 1 else 0 end) undone_tmp, (case when bill_state in ('4','9') then 1 else 0 end) done_tmp from gas_csr_work_bill where area_id='15')
			//          created_time >= to_date(?,'yyyyMMdd') and created_time<to_date(?,'yyyyMMdd')
			var wheres0 = areaId == "1" ? "" : "area_id='" + areaId + "' and "
			var bds0 = {
				"cols": "sum(undone_tmp) undone,sum(done_tmp+undone_tmp) done_all",
				"froms": "(select (case when bill_state in ('0','1','2','3','6','7','8') then 1 else 0 end) undone_tmp, (case when bill_state in ('4','9') then 1 else 0 end) done_tmp from gas_csr_work_bill " +
					" where  " + wheres0 + " created_time >= to_date('" + shijian.lasts + " 00:00:00','yyyy-MM-dd HH24:MI:SS') and created_time<to_date('" + shijian.nexts + " 00:00:00','yyyy-MM-dd HH24:MI:SS'))",
				"wheres": "",
				"pages": false
			}
			// $.ajax({
			// 	url: "/ug/dbc/pbsel.do?bd=" + encodeURIComponent(JSON.stringify(bds0)),
			// 	dataType: 'json',
			// 	async: true
			// }).done(function(data) {
			// 	if(data && data.rows) {
			// 		$("#s_0_0").html(formatnum(data.rows[0].undone))
			// 		$("#s_0_1").html(formatnum(data.rows[0].doneAll))
			// 	}
			// })

			var wheres1 = "";
			//if (UserInfo.item().area_id != '1') {created_time >= to_date('"+shijian.lasts+" 00:00:00','yyyy-MM-dd HH24:MI:SS') and created_time<to_date('"+shijian.nexts+" 00:00:00','yyyy-MM-dd HH24:MI:SS')
			wheres1 += "area_id in (" + loginarea.join() + ") and chg_id='1' and " +
				" trade_date >= to_date('" + shijian.lasts + " 00:00:00','yyyy-MM-dd HH24:MI:SS') and trade_date<to_date('" + shijian.nexts + " 00:00:00','yyyy-MM-dd HH24:MI:SS')"
			//}
			var bds = {
				"cols": "count(*) count,sum(money) sum",
				"froms": "gas_chg_settlement_detail",
				"wheres": wheres1,
				"page": false
			};

			// $.ajax({
			// 	url: "/ug/dbc/pbsel.do?bd=" + encodeURIComponent(JSON.stringify(bds)),
			// 	dataType: 'json',
			// 	async: true
			// }).done(function(data) {
			// 	if(data && data.rows) {
			// 		$("#s_1_0").html(formatnum(data.rows[0].sum))
			// 		$("#s_1_1").html(formatnum(data.rows[0].count))
			// 	}
			// })

			var wheres2 = "";
			wheres2 += "area_id in (" + loginarea.join() + ") and chg_id='2' and " +
				"trade_date >= to_date('" + shijian.lasts + " 00:00:00','yyyy-MM-dd HH24:MI:SS') and trade_date<to_date('" + shijian.nexts + " 00:00:00','yyyy-MM-dd HH24:MI:SS')"
			var bds2 = {
				"cols": "count(*) count,sum(money) sum",
				"froms": "gas_chg_settlement_detail",
				"wheres": wheres2,
				"page": false
			};

			// $.ajax({
			// 	url: "/ug/dbc/pbsel.do?bd=" + encodeURIComponent(JSON.stringify(bds2)),
			// 	dataType: 'json',
			// 	async: true
			// }).done(function(data) {
			// 	if(data && data.rows) {
			// 		if(data.rows[0].sum) {
			// 			$("#s_2_0").html(formatnum(data.rows[0].sum))
			// 		}
			// 		$("#s_2_1").html(formatnum(data.rows[0].count))
			// 	}
			// })
			var years = "",
				months = ""
			if(month == '12' && data >= 26) {
				years = year + 1;
			}
			if(1 <= month <= 12 && 1 <= data < 26) {
				years = year;
				months = month;
			}
			if(1 <= month < 12 && data >= 26) {
				years = year;
				months = month + 1
			}
			var whereClause3 = " report_month='" + months + "' and report_year ='" + years + "' and area_id in (" + loginarea.join() + ")"
			$.ajax({
				url: "hzqs/dbc/pbsel.do",
				type: "POST",
				contentType: "application/json;charset=utf-8",
				data: JSON.stringify({
					cols: "a.customer_kind, sum(normalNum)+sum(stopNum) + sum(longUseNum) + sum(noUseNum) c",
					froms: "gasReportArchive a",
					wheres: whereClause3 + " group by a.customer_kind",
					page: "false",
				}),
				dataType: "json",
				success: function(data) {
					var jumin = "";
					var feijumin = "";
					if(data.rows) {
						$.each(data.rows, function(index, item) {
							if(item.customerKind == "1") {
								jumin = item.c
							}
							if(item.customerKind == "9") {
								feijumin = item.c
							}
						})
						$("#s_3_0").html(jumin)
						$("#s_3_1").html(feijumin)
					}

				}
			})

			//
			//        var calcStatus = function () {
			//            {
			//                var wheres = "flow_def_id!='DAILY_JOB'";
			//                if (UserInfo.item().area_id != '1') {
			//                    wheres += " and be_orgs='" + UserInfo.item().area_id + "'"
			//                }
			//                var bd = {
			//                    "cols": "flow_status,count(1) cnt",
			//                    "froms": " psm_flow_inst ",
			//                    "wheres": wheres,
			//                    "groupby": " flow_status",
			//                    "page": false
			//                };
			//
			////                 $.ajax({
			////                     url: "/txs/dbc/pbsel.do?bd=" + encodeURIComponent(JSON.stringify(bd)),
			////                     dataType: 'json',
			////                     async: true
			////                 })
			////                     .done(function (data) {
			////                         if (data && data.rows) {
			////                             var total = 0;
			////                             var finished = 0;
			////                             $.each(data.rows, function (idx, row) {
			////                                 if (row.flowStatus == '8') finished += row.cnt;
			////                                 if (row.flowStatus != '9') total += row.cnt;
			////                             })
			////                             //$('#stat_0').html((total-finished)+"/"+total)
			////                             upAnim(0, 0, total - finished);
			////                             upAnim(0, 1, total);
			////                         }
			////                     })
			//            }
			//            {
			//                var wheres = "to_char(trade_date,'yyyy-mm')='" + moment().format('YYYY-MM') + "' and created_by !='batch'";
			//                if (UserInfo.item().area_id != '1') {
			//                    wheres += " and area_id='" + UserInfo.item().area_id + "'"
			//                }
			//
			//                var bd = {
			//                    "cols": "trade_type,sum(money) as money,sum(gas) as gas",
			//                    "froms": " gas_act_gasfee_atl ",
			//                    "wheres": wheres,
			//                    "groupby": " trade_type",
			//                    "page": false
			//                };
			//
			//                // $.ajax({
			//                //     url: "/txs/dbc/pbsel.do?bd=" + encodeURIComponent(JSON.stringify(bd)),
			//                //     dataType: 'json',
			//                //     async: true
			//                // })
			//                //     .done(function (data) {
			//                //         if (data && data.rows) {
			//                //             var v0 = 0.0;
			//                //             var v1 = 0.0;
			//                //             $.each(data.rows, function (idx, row) {
			//                //                 if (row.tradeType == 'CHG') v0 += row.money;
			//                //                 if (row.tradeType == 'COR') v0 -= row.money;
			//                //                 if (row.tradeType == 'ICR') v1 += row.gas;
			//                //             })
			//                //             //$('#stat_0').html((total-finished)+"/"+total)
			//                //             upAnim(1, 0, v0);
			//                //             upAnim(1, 1, v1);
			//                //         }
			//                //     })
			//
			//            }
			//
			//            {
			//                var wheres = "copy_state in ('0','1','2','3','4','5','6','7')" +
			//                    "and plan_copy_time >= to_date('" + moment().add(-1, "months").format("YYYY-MM") + "-26 00:00:00','yyyy-mm-dd HH24:MI:SS')"
			//                    + "and plan_copy_time <= to_date('" + moment().format("YYYY-MM") + "-25 23:59:59','yyyy-mm-dd HH24:MI:SS')"
			//                if (UserInfo.item().area_id != '1') {
			//                    wheres += " and area_id='" + UserInfo.item().area_id + "'"
			//                }
			//
			//                var bd = {
			//                    "cols": "copy_state,count(1) as cnt ",
			//                    "froms": " gas_mrd_meter_reading ",
			//                    "wheres": wheres,
			//                    "groupby": " copy_state",
			//                    "page": false
			//                };
			//
			//                // $.ajax({
			//                //     url: "/txs/dbc/pbsel.do?bd=" + encodeURIComponent(JSON.stringify(bd)),
			//                //     dataType: 'json',
			//                //     async: true
			//                // })
			//                //     .done(function (data) {
			//                //         if (data && data.rows) {
			//                //             var v0 = 0;
			//                //             var v1 = 0;
			//                //             $.each(data.rows, function (idx, row) {
			//                //                 if (row.copyState != '0' && row.copyState != '1') v0 += row.cnt;
			//                //                 v1 += row.cnt;
			//                //             })
			//                //             //$('#stat_0').html((total-finished)+"/"+total)
			//                //             upAnim(2, 0, v0);
			//                //             upAnim(2, 1, v1);
			//                //         }
			//                //     })
			//
			//            }
			//        }//interval
			//        setInterval(calcStatus, 30 * 1000);
			//        calcStatus();

		})
//		instanceAction.init();
	</script>

</html>
